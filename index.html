<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panificadora Bacanga</title>

    <!-- √çcones e Manifest -->
    <link rel="icon" type="image/png" href="/icons/favicon-48x48.png" sizes="48x48" />
    <link rel="icon" type="image/svg+xml" href="/icons/favicon.svg" />
    <link rel="shortcut icon" href="/icons/favicon.ico" />
    <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-touch-icon.png" />
    <meta name="apple-mobile-web-app-title" content="Bacanga" />
    <link rel="manifest" href="/icons/site.webmanifest" />

    <!-- Estilos -->
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>

    <h1>Panificadora Bacanga</h1>

    <!-- Formul√°rio de Cadastro -->
    <div id="cadastro">
        <h2>Cadastro</h2>
        <form id="productForm">
            <label for="productName">Nome do Produto:</label>
            <input type="text" id="productName" name="productName" required><br>

            <label for="barcode">C√≥digo de Barras:</label>
            <input type="text" id="barcode" name="barcode" required><br>

            <label for="reference">Refer√™ncia:</label>
            <input type="text" id="reference" name="reference" required><br>

            <label for="price">Valor:</label>
            <input type="number" id="price" name="price" required><br>

            <button type="submit">Cadastrar Produto</button>
        </form>
    </div>

    <!-- √Årea de Pesquisa -->
    <div id="pesquisa">
        <h2>Pesquisar Produto</h2>
        <input type="text" id="searchInput" placeholder="Pesquise aqui">
        <button id="searchButton">üîç Pesquisar</button>
    </div>

    <!-- Tabela de Produtos Cadastrados -->
    <table id="productTable">
        <thead>
            <tr>
                <th>Nome do Produto</th>
                <th>C√≥digo de Barras</th>
                <th>Refer√™ncia</th>
                <th>Valor</th>
                <th>A√ß√µes</th>
            </tr>
        </thead>
        <tbody>
            <!-- Produtos cadastrados ser√£o inseridos aqui -->
        </tbody>
    </table>

    <!-- Bot√£o para baixar o aplicativo -->
    <button id="installButton" style="display: none;">Baixar App</button>

    <!-- Scripts -->
    <script>
        let deferredPrompt;

        // L√≥gica do PWA
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            document.getElementById('installButton').style.display = 'block';
        });

        document.getElementById('installButton').addEventListener('click', () => {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        console.log('Usu√°rio aceitou a instala√ß√£o');
                    } else {
                        console.log('Usu√°rio recusou a instala√ß√£o');
                    }
                    deferredPrompt = null;
                });
            }
        });

        // Registro do Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('/service-worker.js').then(function(registration) {
                    console.log('Service worker registrado com sucesso:', registration);
                }, function(err) {
                    console.log('Falha ao registrar o service worker:', err);
                });
            });
        }

        // Fun√ß√£o para adicionar um produto √† tabela
        const form = document.getElementById('productForm');
        const productTable = document.getElementById('productTable').querySelector('tbody');

        form.addEventListener('submit', function(event) {
            event.preventDefault();

            const productName = document.getElementById('productName').value;
            const barcode = document.getElementById('barcode').value;
            const reference = document.getElementById('reference').value;
            const price = document.getElementById('price').value;

            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${productName}</td>
                <td>${barcode}</td>
                <td>${reference}</td>
                <td>${price}</td>
                <td>
                    <button class="editButton">Alterar</button>
                    <button class="deleteButton">Excluir</button>
                </td>
            `;
            productTable.appendChild(row);

            // Limpar o formul√°rio ap√≥s adicionar
            form.reset();

            // Fun√ß√µes de alterar e excluir
            row.querySelector('.editButton').addEventListener('click', function() {
                editProduct(row);
            });

            row.querySelector('.deleteButton').addEventListener('click', function() {
                deleteProduct(row);
            });
        });

        // Fun√ß√£o para editar um produto
        function editProduct(row) {
            const productName = prompt('Alterar nome do produto:', row.cells[0].textContent);
            const barcode = prompt('Alterar c√≥digo de barras:', row.cells[1].textContent);
            const reference = prompt('Alterar refer√™ncia:', row.cells[2].textContent);
            const price = prompt('Alterar valor:', row.cells[3].textContent);

            if (productName && barcode && reference && price) {
                row.cells[0].textContent = productName;
                row.cells[1].textContent = barcode;
                row.cells[2].textContent = reference;
                row.cells[3].textContent = price;
            }
        }

        // Fun√ß√£o para excluir um produto
        function deleteProduct(row) {
            if (confirm('Tem certeza que deseja excluir este produto?')) {
                row.remove();
            }
        }

        // Fun√ß√£o de pesquisa de produto
        const searchInput = document.getElementById('searchInput');
        const searchButton = document.getElementById('searchButton');

        searchButton.addEventListener('click', function() {
            const searchValue = searchInput.value.toLowerCase();
            const rows = productTable.querySelectorAll('tr');

            rows.forEach(function(row) {
                const productName = row.cells[0].textContent.toLowerCase();
                if (productName.includes(searchValue)) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        });
    </script>

</body>
</html>
