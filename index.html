<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- Ícones e manifest do PWA gerados pelo RealFaviconGenerator -->
    <link rel="icon" type="image/png" href="/icons/favicon-48x48.png" sizes="48x48" />
    <link rel="icon" type="image/svg+xml" href="/icons/favicon.svg" />
    <link rel="shortcut icon" href="/icons/favicon.ico" />
    <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-touch-icon.png" />
    <meta name="apple-mobile-web-app-title" content="Bacanga" />
    <link rel="manifest" href="/icons/site.webmanifest" />
    
    <!-- Título e estilo -->
    <link rel="stylesheet" href="css/styles.css">
    <title>Panificadora Bacanga</title>
</head>
<body>
    <h1>Panificadora Bacanga</h1>
    <h2>Cadastro de Produtos</h2>

    <!-- Formulário de cadastro de produto -->
    <div>
        <label for="productName">Nome do Produto:</label>
        <input type="text" id="productName" placeholder="Digite o nome do produto">
    </div>
    <div>
        <label for="barcode">Código de Barras:</label>
        <input type="text" id="barcode" placeholder="Digite o código de barras">
    </div>
    <div>
        <label for="reference">Referência:</label>
        <input type="text" id="reference" placeholder="Digite a referência">
    </div>
    <div>
        <label for="value">Valor:</label>
        <input type="text" id="value" placeholder="Digite o valor">
    </div>
    <button id="addButton">Adicionar Produto</button>

    <!-- Campo de pesquisa -->
    <h2>Pesquise aqui</h2>
    <input type="text" id="searchInput" placeholder="Digite o nome do produto para pesquisar">
    <button id="searchButton">Pesquisar</button>

    <!-- Tabela de produtos cadastrados -->
    <h2>Produtos Cadastrados</h2>
    <table id="productTable">
        <thead>
            <tr>
                <th>Nome</th>
                <th>Código de Barras</th>
                <th>Referência</th>
                <th>Valor</th>
                <th>Ações</th>
            </tr>
        </thead>
        <tbody>
            <!-- Os produtos serão adicionados dinamicamente aqui -->
        </tbody>
    </table>

    <!-- Botão de Download do App -->
    <h2>Baixar o Aplicativo</h2>
    <button id="installButton" style="display: none;">Instalar App</button>

    <script src="service-worker.js"></script>
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('/service-worker.js').then(function(registration) {
                    console.log('Service worker registrado com sucesso:', registration);
                }, function(err) {
                    console.log('Falha ao registrar o service worker:', err);
                });
            });
        }

        // Array para armazenar os produtos
        let products = [];

        // Função para adicionar produto
        document.getElementById('addButton').addEventListener('click', function() {
            const name = document.getElementById('productName').value;
            const barcode = document.getElementById('barcode').value;
            const reference = document.getElementById('reference').value;
            const value = document.getElementById('value').value;

            if (name && barcode && reference && value) {
                const product = {
                    name,
                    barcode,
                    reference,
                    value
                };

                products.push(product);
                renderTable();
                clearForm();
            } else {
                alert('Por favor, preencha todos os campos!');
            }
        });

        // Função para limpar o formulário
        function clearForm() {
            document.getElementById('productName').value = '';
            document.getElementById('barcode').value = '';
            document.getElementById('reference').value = '';
            document.getElementById('value').value = '';
        }

        // Função para renderizar a tabela de produtos
        function renderTable() {
            const tbody = document.querySelector('#productTable tbody');
            tbody.innerHTML = '';

            products.forEach((product, index) => {
                const row = document.createElement('tr');

                row.innerHTML = `
                    <td>${product.name}</td>
                    <td>${product.barcode}</td>
                    <td>${product.reference}</td>
                    <td>${product.value}</td>
                    <td>
                        <button onclick="editProduct(${index})">Alterar</button>
                        <button onclick="deleteProduct(${index})">Excluir</button>
                    </td>
                `;

                tbody.appendChild(row);
            });
        }

        // Função para editar um produto
        function editProduct(index) {
            const product = products[index];

            document.getElementById('productName').value = product.name;
            document.getElementById('barcode').value = product.barcode;
            document.getElementById('reference').value = product.reference;
            document.getElementById('value').value = product.value;

            // Remover o produto antigo
            products.splice(index, 1);
        }

        // Função para excluir um produto
        function deleteProduct(index) {
            if (confirm('Tem certeza que deseja excluir este produto?')) {
                products.splice(index, 1);
                renderTable();
            }
        }

        // Função para pesquisar um produto
        document.getElementById('searchButton').addEventListener('click', function() {
            const searchQuery = document.getElementById('searchInput').value.toLowerCase();
            const filteredProducts = products.filter(product => product.name.toLowerCase().includes(searchQuery));

            renderSearchResults(filteredProducts);
        });

        // Função para renderizar resultados da pesquisa
        function renderSearchResults(products) {
            const tbody = document.querySelector('#productTable tbody');
            tbody.innerHTML = '';

            products.forEach((product, index) => {
                const row = document.createElement('tr');

                row.innerHTML = `
                    <td>${product.name}</td>
                    <td>${product.barcode}</td>
                    <td>${product.reference}</td>
                    <td>${product.value}</td>
                    <td>
                        <button onclick="editProduct(${index})">Alterar</button>
                        <button onclick="deleteProduct(${index})">Excluir</button>
                    </td>
                `;

                tbody.appendChild(row);
            });
        }

        // Botão para instalação do PWA
        let deferredPrompt;
        const installButton = document.getElementById('installButton');

        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            installButton.style.display = 'block';

            installButton.addEventListener('click', () => {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        console.log('Usuário aceitou instalar o PWA');
                    } else {
                        console.log('Usuário recusou instalar o PWA');
                    }
                    deferredPrompt = null;
                });
            });
        });

        window.addEventListener('appinstalled', (evt) => {
            console.log('PWA instalado com sucesso');
        });
    </script>
</body>
</html>